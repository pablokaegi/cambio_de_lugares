<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèÜ Ranking de la Clase - {{anio.title()}}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin: 20px auto;
            padding: 30px;
            backdrop-filter: blur(10px);
            max-width: 1200px;
        }
        
        .podium {
            display: flex;
            justify-content: center;
            align-items: end;
            margin: 30px 0;
            gap: 20px;
        }
        
        .podium-place {
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            color: white;
            min-width: 150px;
            position: relative;
        }
        
        .podium-1st {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            height: 120px;
            order: 2;
        }
        
        .podium-2nd {
            background: linear-gradient(135deg, #C0C0C0 0%, #A9A9A9 100%);
            height: 100px;
            order: 1;
        }
        
        .podium-3rd {
            background: linear-gradient(135deg, #CD7F32 0%, #B8860B 100%);
            height: 80px;
            order: 3;
        }
        
        .ranking-item {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .ranking-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .ranking-position {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .alumno-info {
            flex-grow: 1;
            margin-left: 15px;
        }
        
        .alumno-nombre {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .alumno-stats {
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        .puntos-info {
            text-align: right;
        }
        
        .puntos-numero {
            font-size: 1.2rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .nivel-badge {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
        }
        
        .badges-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 5px;
        }
        
        .badge-item {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: white;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 0.7rem;
        }
        
        .stats-cards {
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        .btn-custom {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 25px;
            padding: 12px 25px;
            color: white;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin: 5px;
        }
        
        .btn-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
            color: white;
            text-decoration: none;
        }
        
        .gamification-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-container">
            <!-- Header -->
            <div class="text-center mb-4">
                <h1 style="color: #2c3e50; font-weight: 700;">
                    üèÜ Ranking de la Clase {{anio.title()}}
                </h1>
                <p class="lead text-muted">¬°Tabla de l√≠deres del sistema de votaci√≥n gamificado!</p>
            </div>

            <!-- Info de Gamificaci√≥n -->
            <div class="gamification-info">
                <h5><i class="fas fa-gamepad"></i> ¬øC√≥mo funciona la gamificaci√≥n?</h5>
                <div class="row">
                    <div class="col-md-6">
                        <h6>üéØ Ganar Puntos:</h6>
                        <ul class="mb-0">
                            <li><strong>+10 puntos</strong> por votar</li>
                            <li><strong>+2 puntos</strong> por cada valor diferente usado (1-5)</li>
                            <li><strong>+5 puntos</strong> bonus por usar rango completo</li>
                            <li><strong>+3 puntos</strong> por votar en la ma√±ana (8am-12pm)</li>
                            <li><strong>+2 puntos</strong> por votar en la tarde (1pm-5pm)</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>üèÖ Niveles y Badges:</h6>
                        <ul class="mb-0">
                            <li><strong>Nivel:</strong> Cada 50 puntos subes de nivel</li>
                            <li><strong>ü•á Votante Temprano:</strong> Entre los primeros 5</li>
                            <li><strong>üéØ Evaluador Justo:</strong> Uso equilibrado de puntos</li>
                            <li><strong>‚≠ê L√≠der Social:</strong> Puntuaciones altas recibidas</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Estad√≠sticas Generales -->
            <div class="row stats-cards">
                <div class="col-md-3">
                    <div class="stat-card">
                        <h3>{{total_participantes}}</h3>
                        <p>Participantes</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <h3>{{puntos_promedio|round(1)}}</h3>
                        <p>Promedio Puntos</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <h3>{{nivel_promedio|round(1)}}</h3>
                        <p>Nivel Promedio</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <h3>{{total_badges}}</h3>
                        <p>Badges Otorgados</p>
                    </div>
                </div>
            </div>

            <!-- Podium Top 3 -->
            {% if ranking_ordenado|length >= 3 %}
            <div class="podium">
                <!-- 2do Lugar -->
                <div class="podium-place podium-2nd">
                    <div style="font-size: 2rem;">ü•à</div>
                    <strong>{{ranking_ordenado[1][0][:15]}}</strong>
                    <div>{{ranking_ordenado[1][1]['puntos_totales']}} pts</div>
                    <div class="nivel-badge">Nivel {{ranking_ordenado[1][1]['nivel']}}</div>
                </div>
                
                <!-- 1er Lugar -->
                <div class="podium-place podium-1st">
                    <div style="font-size: 2.5rem;">üëë</div>
                    <strong>{{ranking_ordenado[0][0][:15]}}</strong>
                    <div>{{ranking_ordenado[0][1]['puntos_totales']}} pts</div>
                    <div class="nivel-badge">Nivel {{ranking_ordenado[0][1]['nivel']}}</div>
                </div>
                
                <!-- 3er Lugar -->
                <div class="podium-place podium-3rd">
                    <div style="font-size: 2rem;">ü•â</div>
                    <strong>{{ranking_ordenado[2][0][:15]}}</strong>
                    <div>{{ranking_ordenado[2][1]['puntos_totales']}} pts</div>
                    <div class="nivel-badge">Nivel {{ranking_ordenado[2][1]['nivel']}}</div>
                </div>
            </div>
            {% endif %}

            <!-- Ranking Completo -->
            <div class="mt-4">
                <h4><i class="fas fa-list"></i> Clasificaci√≥n Completa</h4>
                
                {% if ranking_ordenado %}
                    {% for alumno, stats in ranking_ordenado %}
                    <div class="ranking-item">
                        <div class="ranking-position">{{loop.index}}</div>
                        
                        <div class="alumno-info">
                            <div class="alumno-nombre">{{alumno}}</div>
                            <div class="alumno-stats">
                                Vot√≥ el: {{stats.fecha_ultimo_voto[:10] if stats.fecha_ultimo_voto else 'No ha votado'}}
                            </div>
                            {% if stats.badges %}
                            <div class="badges-container">
                                {% for badge in stats.badges %}
                                <span class="badge-item">{{badge}}</span>
                                {% endfor %}
                            </div>
                            {% endif %}
                            
                            <!-- En la secci√≥n del ranking individual, agregar: -->
                            <div class="trivia-stats" style="font-size: 0.8rem; margin-top: 5px;">
                                {% if stats.trivia_stats %}
                                <div style="color: #6c757d;">
                                    üß† Trivia: {{stats.trivia_stats.preguntas_correctas}}/{{stats.trivia_stats.preguntas_respondidas}} 
                                    ({{((stats.trivia_stats.preguntas_correctas / stats.trivia_stats.preguntas_respondidas) * 100)|round(0)}}%)
                                    
                                    {% if stats.trivia_stats.mejor_racha > 0 %}
                                    | üî• Mejor racha: {{stats.trivia_stats.mejor_racha}}
                                    {% endif %}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="puntos-info">
                            <div class="puntos-numero">{{stats.puntos_totales}} pts</div>
                            <div class="nivel-badge">Nivel {{stats.nivel}}</div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-trophy" style="font-size: 3rem; color: #dee2e6; margin-bottom: 20px;"></i>
                        <h5 class="text-muted">¬°A√∫n no hay rankings!</h5>
                        <p class="text-muted">Los alumnos aparecer√°n aqu√≠ cuando empiecen a votar.</p>
                    </div>
                {% endif %}
            </div>

            <!-- Botones de Acci√≥n -->
            <div class="text-center mt-4">
                <a href="{{ url_for('home', anio=anio) }}" class="btn-custom">
                    <i class="fas fa-arrow-left"></i> Volver al Home
                </a>
                
                <a href="{{ url_for('estadisticas', anio=anio) }}" class="btn-custom">
                    <i class="fas fa-chart-bar"></i> Ver Estad√≠sticas
                </a>
            </div>
        </div>
    </div>

    <script>
        // Animaciones de entrada
        document.addEventListener('DOMContentLoaded', function() {
            const items = document.querySelectorAll('.ranking-item');
            items.forEach((item, index) => {
                item.style.opacity = '0';
                item.style.transform = 'translateX(-20px)';
                
                setTimeout(() => {
                    item.style.transition = 'all 0.5s ease';
                    item.style.opacity = '1';
                    item.style.transform = 'translateX(0)';
                }, index * 100);
            });
        });
    </script>
</body>
</html>